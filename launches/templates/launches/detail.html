{% extends "base/base.html" %}
{% load static %}

{% block stylesheet %}
    <link rel="stylesheet" type="text/css" href="{% static 'launches/detail.css' %}">
{% endblock %}

{% block title %}{{ launch.mission_name }}{% endblock %}

{% block content %}
    {% if not launch.error %}
        <div class="launch">
            <div class="launch_details">
                <div class="top_right">
                    {% if launch.links.mission_patch_small %}
                        <div>
                            <img class="mission_patch" src="{{ launch.links.mission_patch_small }}" >
                        </div>
                    {% endif %}
                    {% if launch.links.presskit or launch.links.video_link %}
                        <div class="buttons_container">
                            {% if launch.links.presskit %}
                                <a class="press_kit" href="{{ launch.links.presskit }}" target="_blank">Download Press Kit</a>
                            {% endif %}
                            {% if launch.links.video_link %}
                                <a class="youtube_link" href="https://www.youtube.com/watch?v={{ launch.links.youtube_id }}" target="_blank">Watch Launch</a>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
                <h1>{{ launch.mission_name }} | {{ launch.rocket.rocket_name }}</h1>
                {% if launch.upcoming %}
                    <div class="upcoming_launch">Upcoming Launch</div>                
                {% else %}
                {% endif %}
                <h3>Flight Number: {{ launch.flight_number }}</h3>
                <table>
                    <tr>
                        <td>Date:</td>
                        <td>{{ launch.launch_datetime|date:"D, d M Y" }}</td>
                    <tr>
                    <tr>
                        <td>Time:</td>
                        <td>{{ launch.launch_datetime|time }}</td>
                    <tr>
                    {% if launch.is_tentative %}
                        <tr>
                            <td>Launch Data Tentative:</td>
                            <td>{{ launch.is_tentative }}</td>
                        <tr>
                        <tr>
                            <td>Launch Data Precision:</td>
                            <td>{{ launch.tentative_max_precision }}</td>
                        <tr>
                        <tr>
                            <td>Launch Date TBD:</td>
                            <td>{{ launch.tbd }}</td>
                        <tr>
                    {% endif %}
                </table>
                <h2>Launch Site</h2>
                <a href="{% url 'launchpads:detail' launch.launch_site.site_id %}">
                    {{ launch.launch_site.site_name_long }}
                </a>
                <h2>Launch Details</h2>
                <p>{{ launch.details }}</p>
                {% if not launch.crew is None %}
                    <h2>Crew</h2>
                    <p>{{ launch.crew }}</p>
                {% endif %}
                <div class="stages_container">
                    {% if launch.rocket.first_stage %}
                        {% if launch.rocket.first_stage.cores %}
                            <div class="first_stage_details">
                                <h2>First Stage</h2>
                                {% for core in launch.rocket.first_stage.cores %}
                                    {% if launch.rocket.first_stage.cores|length > 1 %}
                                        <h3>Core {{ forloop.counter }}</h3>
                                    {% endif %}
                                    <p>Core Serial: <a href="{% url 'cores:detail' core.core_serial %}">{{ core.core_serial }}</a></p>
                                    <p>Flight no: {{ core.flight }}</p>
                                    <p>Block {{ core.block }}</p>
                                {% endfor %}
                            </div>
                        {% endif %}
                    {% endif %}
                    {% if launch.rocket.second_stage %}
                        {% if launch.rocket.second_stage.payloads %}
                            <div class="second_stage_details">
                                <h2>Second Stage</h2>
                                {% for payload in launch.rocket.second_stage.payloads %}
                                    {% if launch.rocket.second_stage.payloads|length > 1 %}
                                        <h3>Payload {{ forloop.counter }}</h3>
                                    {% endif %}
                                    <p>Payload: {{ payload.payload_id }}</p>
                                    <p>Customers: {{ payload.customers|join:", " }}</p>
                                    <p>Nationality: {{ payload.nationality }}</p>
                                    <p>Manufacturer: {{ payload.manufacturer }}</p>
                                    <p>Payload Type: {{ payload.payload_type }}</p>
                                    <p>Payload Mass: {{ payload.payload_mass_kg }}kg</p>
                                {% endfor %}
                            </div>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
            <div class="side_bar">
                <div class="launch_assets">
                    {% if launch.links.flickr_images %}
                        {% for image in launch.links.flickr_images %}
                            <img src={{ image }} >
                        {% endfor %}
                    {% endif %}
                </div>
                <div style="width: 100%">
                    <iframe
                        width="100%"
                        height="600"
                        src="https://maps.google.com/maps?width=100%&amp;height=600&amp;hl=en&amp;q={{ launchpad.location.latitude }},{{ launchpad.location.longitude }}&amp;ie=UTF8&amp;t=k&amp;z=15&amp;iwloc=B&amp;output=embed"
                        frameborder="0"
                        scrolling="no"
                        marginheight="0"
                        marginwidth="0"
                    >
                    </iframe>
                </div>
            </div>
        </div>
    {% else %}
        <h2>Error</h2>
        <p>{{ launch.error }}</p>
    {% endif %}
{% endblock %}